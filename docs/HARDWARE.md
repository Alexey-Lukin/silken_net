# Energy Harvesting Hardware

## The Challenge

Power an MCU + LoRa transceiver from 44mV tree bio-potential (streaming potential generated by xylem pH gradient and ion transport).

## System Block Diagram

```
Tree Xylem (44mV)
      │
      ▼
┌─────────────┐     ┌──────────────┐     ┌─────────────┐     ┌──────────┐
│ LTC3108     │────▶│ BQ25570      │────▶│ 0.47F       │────▶│ LoRa-E5  │
│ Meissner    │     │ MPPT Manager │     │ Supercap    │     │ STM32    │
│ Oscillator  │     │ (CJMCU)      │     │ (5.5V)      │     │ WLE5JC   │
└─────────────┘     └──────────────┘     └─────────────┘     └──────────┘
  1:100 xfmr          488nA idle           4.145J @ 4.2V      2.1uA sleep
  330pF resonant       VOC sampling/16s    Energy buffer       +22dBm TX
```

## Stage 1: Bio-Potential Simulation (Breadboard)

For development and testing, the 44mV bio-potential is simulated:

- **Source:** AA battery (1.5V) + voltage divider
- **Divider:** R1 = 3.3 kOhm, R2 = 100 Ohm
- **Output:** V_out = 1.5V x 100 / (3300 + 100) = 44.1 mV
- **Thevenin equivalent:** R_th = 97 Ohm, I_short = 454 uA

## Stage 2: Ultra-Low-Voltage Boost (LTC3108)

The LTC3108 starts from as low as 20mV using a Meissner oscillator topology:

- **Transformer:** Coilcraft LPR6235-752SMRC (1:100 turns ratio, 7.5 uH primary, DCR = 0.085 Ohm)
- **Resonant capacitor:** 330 pF (sets oscillation frequency)
- **Topology:** Depletion-mode MOSFET drives transformer primary; secondary voltage is rectified by internal charge pump
- **Output:** 3-5V at microamp-level current (powers BQ25570 cold start)

## Stage 3: Power Management (BQ25570 / CJMCU-25570)

Nano-power boost charger with MPPT:

- **Cold start:** From 330 mV (fed by LTC3108 output)
- **MPPT:** Samples V_OC every 16 seconds, tracks maximum power point
- **Storage:** Charges 0.47F / 5.5V supercapacitor
- **Energy stored:** E = 0.5 x C x V^2 = 0.5 x 0.47 x 4.2^2 = 4.145 J at 4.2V
- **Buck output:** Stable 3.3V at up to 110 mA (for LoRa TX bursts)
- **Quiescent current:** 488 nA (near-zero idle drain)

## Stage 4: LoRa-E5 Mini (Seeed Studio)

The compute and communication module:

- **SoC:** STM32WLE5JC (ARM Cortex-M4 + LoRa SX1262)
- **Deep sleep:** 2.1 uA (STOP2 mode)
- **TX power:** Up to +22 dBm (adjustable for energy budget)
- **Frequency:** 868 MHz (EU ISM band)
- **Flash:** 256 KB (firmware + mruby bytecode + TinyML weights)
- **SRAM:** 64 KB

## Piezoelectric Wake-Up

Zero-power event detection for chainsaw/vibration alerts:

- **Sensor:** ZP-3 or ZP-5 piezoelectric disk (passive, no power required)
- **Clamping:** BAT54S Schottky diode pair limits voltage to 0-3.3V range
- **Trigger:** EXTI rising edge interrupt on STM32 GPIO
- **Use case:** Immediate wake from deep sleep on mechanical disturbance (vandalism, chainsaw, seismic event)

## Programming Interface

### SWD (Debug/Flash)

- **Programmer:** ST-LINK-V3MINIE
- **Connections:** SWDIO, SWCLK, NRST, 3.3V, GND
- **Use:** Firmware flashing, debugging, factory provisioning

### UART (Serial Console)

- **Adapter:** FT232RL USB-UART (3.3V mode mandatory)
- **Connections:** TX cross-wired to RX, RX cross-wired to TX, GND
- **Use:** Debug logging, mruby REPL, AT commands

## Energy Budget

| Parameter | Value |
|-----------|-------|
| Input power | 19.8 uW (44mV x 450uA) |
| Energy generated per hour | 71.28 mJ |
| Sleep overhead per hour | 30.74 mJ (2.1uA x 3.3V x 3600s + BQ25570 quiescent) |
| Energy per TX cycle | 37.95 mJ (120mA x 3.3V x 96ms @ +14dBm) |
| **Sustainable TX rate** | **~1 message/hour** |
| Growth points per day | ~24 (1 cycle/hour x 24 hours) |

## Bill of Materials (BOM)

| # | Component | Specification |
|---|-----------|--------------|
| 1 | LTC3108 | Ultra-low voltage step-up converter |
| 2 | Coilcraft LPR6235-752SMRC | 1:100 coupled inductor, 7.5uH primary |
| 3 | 330 pF capacitor | C0G/NP0, resonant tank |
| 4 | 4.7 uF capacitor | VAUX storage |
| 5 | 1 uF capacitor | VOUT decoupling |
| 6 | BQ25570 (CJMCU-25570) | Nano-power MPPT charger |
| 7 | 0.47F / 5.5V supercapacitor | Energy storage |
| 8 | LoRa-E5 mini (Seeed Studio) | STM32WLE5JC module |
| 9 | ZP-3 / ZP-5 piezo disk | Acoustic/vibration sensor |
| 10 | BAT54S | Dual Schottky diode (piezo clamping) |
| 11 | ST-LINK-V3MINIE | SWD programmer |
| 12 | FT232RL | USB-UART adapter (3.3V) |
| 13 | 3.3 kOhm resistor | Voltage divider R1 (simulation) |
| 14 | 100 Ohm resistor | Voltage divider R2 (simulation) |
| 15 | AA battery holder | Bio-potential simulation source |
| 16 | Breadboard + jumper wires | Prototyping |
